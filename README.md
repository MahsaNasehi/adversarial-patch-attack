# Adversarial Patch Attack on MNIST Classifier

This project demonstrates a simple implementation of an adversarial patch attack against a Convolutional Neural Network (CNN) trained on the MNIST dataset. The goal is to generate a small, universal patch that, when applied to any input image, causes the model to misclassify it as a specific target class.

This implementation uses the **Expectation Over Transformation (EOT)** technique to create a patch that is robust to random translations, rotations, and scaling.

---

## Results

Here are the results of a successful attack. The goal was to make the model classify any digit as the target class `2`.

### Generated Adversarial Patch

This is the optimized adversarial patch. When placed on an image, it strongly activates the neurons associated with the target class.

![Adversarial Patch](assets/patch_visualization.png)
_Note: You need to generate this image and place it in an `assets` folder._

### Attack Examples

The following images show the patch's effectiveness. The top row contains original images from the test set (correctly classified), and the bottom row shows the same images with the adversarial patch applied. The model's prediction for the patched images is consistently fooled into the target class.

| Original Images (Predicted Correctly) | Patched Images (Fooled to Class '2') |
| :---: | :---: |
| ![Original Examples](results/original.png) | ![Patched Examples](results/patched.png) |

_These images are automatically generated by running the `eval_patch.py` script._

---

## Getting Started

Follow these instructions to set up the environment and run the project on your local machine.

### Prerequisites

- Python 3.8+
- Git

### Installation

1.  **Clone the repository:**
```bash
git clone https://github.com/MahsaNasehi/adversarial-patch-attack.git
cd adversarial-patch-attack
```

2.  **Create and activate a virtual environment:**
```bash
# For Windows
python -m venv venv
.\venv\Scripts\activate

# For macOS/Linux
python -m venv venv
source venv/bin/activate
```

3.  **Install the required dependencies:**
```bash
pip install -r requirements.txt
```

---

## Usage

The workflow is divided into three main steps: training the classifier, generating the patch, and evaluating the attack.

### 1. Train the MNIST Classifier

First, train the base CNN model. The trained weights will be saved to a file.
```bash
python src/train_model.py --save_path models/mnist_cnn.pth --epochs 5
*This will create a `models/` directory and save `mnist_cnn.pth` inside it.*

### 2. Generate the Adversarial Patch

Next, use the trained model to generate the adversarial patch.

bash
python src/train_patch.py --model_path models/mnist_cnn.pth --save_path models/mnist_patch.pth --target 2 --epochs 10
*This command will generate a patch that fools the model into predicting class `2`.*

### 3. Evaluate and Visualize the Attack

Finally, evaluate the patch's success rate (fooling rate) and generate visualization images (`original.png` and `patched.png`).

bash
python src/eval_patch.py --model_path models/mnist_cnn.pth --patch_path models/mnist_patch.pth --out_dir results
*The output images will be saved in the `results/` directory.*

---

## Running Tests

To ensure everything is set up correctly, you can run the provided smoke tests using `pytest`.

bash
pytest

---

## Project Structure


.
├── models/               # Directory for saved model and patch weights
├── results/              # Directory for visualization outputs
├── src/                  # Source code for the project
│   ├── data.py           # MNIST data loaders
│   ├── model.py          # CNN model definition
│   ├── patch.py          # Functions for patch creation and application (EOT)
│   ├── train_model.py    # Script to train the base classifier
│   ├── train_patch.py    # Script to train the adversarial patch
│   └── eval_patch.py     # Script to evaluate the patch and create visualizations
├── tests/                # Test suite
│   └── test_patch.py     # Smoke test for the training pipeline
├── .gitignore            # Files to be ignored by Git
├── requirements.txt      # Project dependencies
└── README.md             # This file
`
